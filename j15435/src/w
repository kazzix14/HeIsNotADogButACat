/* 
 * view.c
 *
 * (C) 2018 Kazuma Murata
 * 
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

#define GLUT_DISABLE_ATEXIT_HACK

#include <stdbool.h>
#include <GL/glut.h>

#include "view.h"
#include "vector3d.h"

struct private_variables
{
};

View* View_new()
{
	// allocate memory for private varibles
	View *v;
	v = (View*)malloc(sizeof(View));
	v->p_vars = (struct private_variables*)malloc(sizeof(struct private_variables));
	
	return v;
}

void View_release(View* const p_this)
{
	free(p_this->p_vars);
	free(p_this);
}

void View_begin_2d(const View* p_this)
{
	glMatrixMode(GL_PROJECTION);
	glPushMatrix();
	glLoadIdentity();
	gluOrtho2D(p_this->position.x, p_this->position.x+p_this->windows_width,
		   p_this->position.y+p_this->windows_height, p_this->position.y);

	//glScaled(1, -1, 1);
	//glTranslated(0, -h, 0.0);

	glMatrixMode(GL_MODELVIEW);
	glPushMatrix();
	glLoadIdentity();
}

void View_begin_3d(const View* p_this)
{
	glMatrixMode(GL_PROJECTION);
	glPushMatrix();
	glLoadIdentity();
	gluPerspective(30.0, (double)p_this->window_width / (double)p_this->window_height, 1.0, 10000.0);

	glScaled(1, -1, 1);
	glTranslated(0, -p_this->window_height, 0.0);

	glMatrixMode(GL_MODELVIEW);
	glPushMatrix();
	glLoadIdentity();
	
	gluLookAt(0.0, 0.0, 2000.0,
		  0.0, -500.0, 0.0,
		  0.0, 1.0, 0.0);
}

void View_end()
{
	glMatrixMode(GL_PROJECTION);
	glPopMatrix();
	glMatrixMode(GL_MODELVIEW);
	glPopMatrix();
}

bool View_is_visible_2d(const View* this, const Vector2D* vec1)
{
	Vector2D vec2;
       	Vector3D_to_Vector2D(this->position, &vec2);
	if(Vector2D_compare(vec1, &vec2) == 0x2){ 				// LB 0010
		if(Vector2D_compare(vec1, &vec2) == 0x2){ 			// 0010
			if(Vector2D_compare(vec1, &vec2) == 0x2){ 		// 0010
				if(Vector2D_compare(vec1, &vec2) == 0x2){ 	// 0010

	}	}	}	}			
	gluOrtho2D(p_this->position.x, p_this->position.x+p_this->window_width,
		   p_this->position.y+p_this->window_height, p_this->position.y);
	return true;
}
